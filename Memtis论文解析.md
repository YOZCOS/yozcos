### Memtis论文解析

**论文标题**: Memtis: Efficient Memory Tiering with Dynamic Page Classification and Page Size Determination

**作者**: Taehyung Lee, Sumit Kumar Monga, Changwoo Min, Young Ik Eom

**所属机构**: Sungkyunkwan University, Virginia Tech, Igalia

**发表会议**: SOSP ’23

**核心贡献**:
Memtis是一个高效的分层内存系统，它通过动态页面分类和页面大小决定来优化内存访问性能。它主要解决了现有内存分层系统中存在的页面放置决策不佳和页面大小选择困难的问题。

**关键概念**:
1. **内存分层（Tiered Memory）**: 利用具有不同容量、延迟和成本特性的多种内存类型，以降低服务器硬件成本，同时满足内存需求。
2. **动态页面分类**: Memtis根据页面访问分布动态决定页面应该放置在快速层（如本地DRAM）还是容量层（如NVM或CXL附加内存）。
3. **页面大小确定**: Memtis能够根据应用的需求动态决定页面大小，允许使用大页面以减少地址转换开销，同时避免因页面访问偏斜而导致的快速层内存浪费。

**系统设计**:
- **ksampled**: 这是一个内核后台线程，负责使用Intel的PEBS（Processor Event-Based Sampling）技术采样内存访问事件，并更新内存访问统计信息。它还负责更新两个直方图，这两个直方图用于页面热度分类和大页面拆分决策。
- **kmigrated**: 这个内核线程负责执行页面的迁移操作，包括将页面从快速层迁移到容量层，或者反过来。它在后台运行，以避免影响应用程序的性能。

**工作流程**:
1. **内存访问跟踪**: 使用PEBS采样内存访问，并将采样得到的内存访问信息存储在PEBS缓冲区中。
2. **页面热度分类**: ksampled在处理PEBS样本时，会更新页面的热度因子，并根据热度因子的变化，将页面分类为热、温或冷页面。
3. **页面迁移与拆分**: kmigrated会定期检查直方图，并根据当前的热度分类和内存访问模式，执行页面的晋升或降级操作。此外，kmigrated还负责拆分那些高度偏斜的大页面，即将那些只有少数子页面频繁访问的大页面拆分成更小的页面，以便更有效地利用快速层内存。

**性能优化**:
Memtis通过动态调整页面的放置和大小，优化了多层内存系统的性能。它能够根据应用的内存访问模式，智能地将热数据集近似到快速层的容量，同时动态确定页面大小，允许应用程序使用大页面，同时避免其缺点。

**实验结果**:
评估结果显示，Memtis在几乎所有情况下都优于现有的分层内存系统，平均性能提升了33.6%，并且在动态拆分大页面的基础上，性能最高可提高19.9%，内存膨胀减少了45.4%。

**总结**:
Memtis通过其创新的动态页面分类和页面大小决定机制，为内存分层系统提供了一种有效的性能优化方案。它解决了现有系统中存在的一些关键问题，并在实际应用中显示出显著的性能提升。论文和幕布文档的结合表明，项目团队正在积极地进一步开发和完善这一系统。